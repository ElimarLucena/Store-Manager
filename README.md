# Boas-vindas ao reposit√≥rio do Projeto Store Manager!

# Entreg√°veis

<details>
  <summary><strong>üë®‚Äçüíª O que dever√° ser desenvolvido</strong></summary><br />

  Voc√™ vai desenvolver sua primeira API utilizando a arquitetura MSC (model-service-controller)!

  A API a ser constru√≠da √© um sistema de gerenciamento de vendas em que ser√° poss√≠vel criar, visualizar, deletar e atualizar produtos e vendas.

  Voc√™ dever√° utilizar o banco MySQL para a gest√£o de dados. Al√©m disso, a API deve ser RESTful.

  <br />
</details>

# Orienta√ß√µes

<details>
  <summary><strong>‚ö†Ô∏è Observa√ß√µes importantes</strong></summary><br />

  - A pessoa usu√°ria, independente de cadastro ou login, deve conseguir:

    - Adicionar, ler, deletar e atualizar produtos no estoque;

    - Enviar vendas para o sistema e essas vendas devem validar se o produto em quest√£o existe;

    - Ler, deletar e atualizar venda.

  - Para **todos os endpoints** garanta que:

    - Caso o recurso **n√£o seja encontrado**, **aconte√ßa um erro** ou **haja dados inv√°lidos** na sua requisi√ß√£o, sua API deve retornar o status HTTP adequado com o body `{ message: <mensagem de erro> }`;

    - Todos os retornos de erro devem seguir o mesmo formato.

   <br />
 </details>

<details>
  <summary><strong>üëÄ Dicas importantes</strong></summary><br />

  - Para gerar os objetos de erro personalizados, voc√™ pode utilizar uma biblioteca de erros, como o [`boom`](https://www.npmjs.com/package/@hapi/boom);

  - Voc√™ pode utilizar middlewares e objetos de erro personalizados para que n√£o tenha que repetir a l√≥gica de tratamento de erro em v√°rios lugares. N√£o se esque√ßa tamb√©m do [express-rescue](https://www.npmjs.com/package/express-rescue), ele pode facilitar muito o trabalho de tratar erros;

  - Quando estiver na d√∫vida sobre qual status HTTP utilizar, voc√™ pode consultar sites como o [httpstatuses.com](https://httpstatuses.com/), [restapitutorial.com](https://www.restapitutorial.com/httpstatuscodes.html) ou a [documenta√ß√£o sobre o assunto no MDN](https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status). Com o tempo, voc√™ vai lembrar com facilidade o significado dos c√≥digos mais comuns;

  - Para realizar a valida√ß√£o dos dados, voc√™ pode utilizar pacotes como [`Joi`](https://www.npmjs.com/package/joi) ou o [`Expresso Validator`](https://www.npmjs.com/package/@expresso/validator). Caso prefira, voc√™ tamb√©m pode realizar a valida√ß√£o de forma manual.

  - Para esse projeto, √© importante recorrer a leitura e fazer os exerc√≠cios do dia [Arquitetura de Software - Camada de Controller e Service](https://app.betrybe.com/course/back-end/nodejs-camada-de-servico-e-arquitetura-rest-e-restful/arquitetura-de-software-camada-de-controller-e-service/f8eeda7e-dd20-4a59-a0d9-3d4ec20729bc) *(Especialmente a se√ß√£o `B√¥nus` > `Inserindo dados em mais de uma tabela`)*

  <br />
</details>

<details>
  <summary><strong>:whale: Rodando no Docker vs Localmente</strong></summary><br />

  ## Com Docker

  > Rode os servi√ßos `node` e `db` com o comando `docker-compose up -d`.
  - Lembre-se de parar o `mysql` se estiver usando localmente na porta padr√£o (`3306`), ou adapte, caso queria fazer uso da aplica√ß√£o em containers;
  - Esses servi√ßos ir√£o inicializar um container chamado `store_manager` e outro chamado `store_manager_db`;
  - A partir daqui voc√™ pode rodar o container `store_manager` via CLI ou abri-lo no VS Code.

  > Use o comando `docker exec -it store_manager bash`.
  - Ele te dar√° acesso ao terminal interativo do container criado pelo compose, que est√° rodando em segundo plano.

  > Instale as depend√™ncias [**Caso existam**] com `npm install`

  ‚ö† Aten√ß√£o ‚ö† Caso opte por utilizar o Docker, **TODOS** os comandos dispon√≠veis no `package.json` (npm start, npm test, npm run dev, ...) devem ser executados **DENTRO** do container, ou seja, no terminal que aparece ap√≥s a execu√ß√£o do comando `docker exec` citado acima.

  ‚ö† Aten√ß√£o ‚ö† O **git** dentro do container n√£o vem configurado com suas credenciais. Ou fa√ßa os commits fora do container, ou configure as suas credenciais do git dentro do container.

  ‚ö† Aten√ß√£o ‚ö† N√£o rode o comando npm audit fix! Ele atualiza v√°rias depend√™ncias do projeto, e essa atualiza√ß√£o gera conflitos com o avaliador.


‚ú® **Dica:** A extens√£o `Remote - Containers` (que estar√° na se√ß√£o de extens√µes recomendadas do VS Code) √© indicada para que voc√™ possa desenvolver sua aplica√ß√£o no container Docker direto no VS Code, como voc√™ faz com seus arquivos locais.

<img src="images/remote-container.png" width="800px" >

  ---

  ## Sem Docker

  > Instale as depend√™ncias [**Caso existam**] com `npm install`

  ‚ö† Aten√ß√£o ‚ö† N√£o rode o comando npm audit fix! Ele atualiza v√°rias depend√™ncias do projeto, e essa atualiza√ß√£o gera conflitos com o avaliador.

  ‚ú® **Dica:** Para rodar o projeto desta forma, obrigatoriamente voc√™ deve ter o `node` instalado em seu computador.

  ‚ú® **Dica:** O avaliador espera que a vers√£o do `node` utilizada seja a 16.

  <br/>
</details>

<details>
  <summary><strong>‚ÄºÔ∏è Antes de come√ßar a desenvolver</strong></summary><br />

  1. Clone o reposit√≥rio

  - `git clone git@github.com:ElimarLucena/Store-Manager.git;

  - Entre na pasta do reposit√≥rio que voc√™ acabou de clonar:
    - `cd Store-manager`

  2. Instale as depend√™ncias [**Caso existam**]

  - `npm install`

  #### :warning: ATEN√á√ÉO: N√£o rode o comando `npm audit fix`! *Ele atualiza v√°rias depend√™ncias do projeto, e essa atualiza√ß√£o gera conflitos com o avaliador.*
  <br />
</details>

<details>
  <summary><strong>üì• Todos os seus endpoints devem estar no padr√£o REST</strong></summary><br />

  - Use os verbos HTTP adequados para cada opera√ß√£o;

  - Agrupe e padronize suas URL em cada recurso;

  - Garanta que seus endpoints sempre retornem uma resposta, havendo sucesso nas opera√ß√µes ou n√£o;

  - E retorne os c√≥digos de status corretos (recurso criado, erro de valida√ß√£o, autoriza√ß√£o, etc).

  <br />
</details>

<details>
  <summary><strong>üé≤ Conex√£o com o Banco</strong></summary><br />

:warning: **IMPORTANTE!**

```javascript
require('dotenv').config(); // n√£o se esque√ßa de configurar suas vari√°veis de ambiente aqui na configura√ß√£o

const connection = mysql.createPool({
  host: process.env.MYSQL_HOST,
  user: process.env.MYSQL_USER,
  password: process.env.MYSQL_PASSWORD,
  database: process.env.MYSQL_DATABASE || 'StoreManager',
});
```

Renomeie o arquivo `.env.example` para `.env`** com as vari√°veis de ambiente. Por exemplo, caso o seu usu√°rio SQL seja `nome` e a senha `1234` seu arquivo ficar√° desta forma:

```sh
MYSQL_HOST=localhost
MYSQL_USER=nome
MYSQL_PASSWORD=1234
MYSQL_DATABASE=StoreManager
PORT=3000
```
</details>

<details>
  <summary><strong>üñº Tabelas</strong></summary><br />

Na raiz do projeto existe o arquivo `StoreManager.sql` que ser√° usado para rodar os testes. Voc√™ pode import√°-lo localmente para testar o comportamento da sua aplica√ß√£o durante o desenvolvimento.

O banco ter√° tr√™s tabelas: `products`, `sales` e `sales_products`.

A tabela `products` tem o seguinte formato:

![Tabela Produtos](./public/tableproducts.png)

(O id ser√° gerado automaticamente)

A tabela `sales` tem o seguinte formato:

![Tabela Vendas](./public/tablesales.png)

(O id e date s√£o gerados automaticamente)

A tabela `sales_products`, √© a tabela que faz o relacionamento `N:N` entre `products` e `sales` e tem o seguinte formato:

![Tabela Vendas-Produtos](./public/tablesalesproducts.png)

  <br />
</details>

<details>
  <summary><strong>üéõ Linter</strong></summary><br />

  Voc√™ pode tamb√©m instalar o plugin do `ESLint` no `VSCode`, basta baixar o [plugin `ESLint`](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint) e instal√°-lo

  <br />
</details>

# Requisitos do Projeto

## Teste 35% das camadas da aplica√ß√£o

- **Como citado [aqui](#para-escrever-seus-pr√≥pios-arquivos-de-teste)**;

- Seus testes da `model` devem fazer mock do banco de dados obrigat√≥riamente;

</details>

## Crie endpoints para listar os produtos e as vendas

### :information_source: Para **Produtos**

- O endpoint para listar produtos deve ser acess√≠vel atrav√©s do caminho (`/products`) e (`/products/:id`);

- Atrav√©s do caminho `/products`, todos os produtos devem ser retornados;

- Atrav√©s do caminho `/products/:id`, apenas o produto com o `id` presente na URL deve ser retornado;

- o resultado deve ser **ordernado** de forma crescente pelo campo `id`;
</details>

### :information_source: Para **Vendas**

- O endpoint para listar vendas deve ser acess√≠vel atrav√©s do caminho (`/sales`) e (`/sales/:id`);

- Atrav√©s do caminho `/sales`, todas as vendas devem ser retornadas;

- Atrav√©s do caminho `/sales/:id`, apenas a venda com o `id` presente na URL deve ser retornada;

- o resultado deve ser **ordernado** de forma crescente pelo campo `saleId`, em caso de empate, **ordernar** tamb√©m de forma crescente pelo campo `productId`;

</details>

## Crie middlewares de valida√ß√£o para as rotas `/products` e `/sales`

### :information_source: Para **Produtos**

- O endpoint de produtos deve ser acess√≠vel atrav√©s do caminho (`/products`);

- Lembre-se, o banco de dados n√£o deve ser acessado nas valida√ß√µes iniciais do corpo da requisi√ß√£o;

</details>

### :information_source: Para **Vendas**

- O endpoint de produtos deve ser acess√≠vel atrav√©s do caminho (`/sales`);

- Lembre-se, o banco de dados n√£o deve ser acessado nas valida√ß√µes iniciais do corpo da requisi√ß√£o;
  
</details>

## Crie um endpoint para o cadastro de produtos

- O endpoint deve ser acess√≠vel atrav√©s do caminho (`/products`);

- Os produtos enviados devem ser salvos na tabela `products` do Banco de Dados;

- *Observe as regras de neg√≥cio e coloque na camada certa;*

</details>

## Crie um endpoint para atualizar um produto

- O endpoint deve ser acess√≠vel atrav√©s do caminho (`/products/:id`);

- O corpo da requisi√ß√£o deve seguir a mesma estrutura do m√©todo respons√°vel por adicionar um produto;

- Apenas o produto com o `id` presente na URL deve ser atualizado;

- *Observe as regras de neg√≥cio e coloque na camada certa;*

</details>

## Crie um endpoint para deletar um produto

- O endpoint deve ser acess√≠vel atrav√©s do caminho (`/products/:id`);

- Apenas o produto com o `id` presente na URL deve ser deletado;

- *Observe as regras de neg√≥cio e coloque na camada certa;*

</details>

## Crie um endpoint para cadastrar vendas

- O endpoint deve ser acess√≠vel atrav√©s do caminho (`/sales`);

- As vendas enviadas devem ser salvas na tabela `sales` e `sales_products` do Banco de dados;

- Deve ser poss√≠vel cadastrar a venda de v√°rios produtos atrav√©s da uma mesma requisi√ß√£o;

- *Observe as regras de neg√≥cio e coloque na camada certa;*

>üí¨ Em caso de d√∫vidas, lembre-se de consultar a se√ß√£o `Dicas importantes`, neste README

</details>

## Crie um endpoint para atualizar uma venda

- O endpoint deve ser acess√≠vel atrav√©s do caminho (`/sales/:id`);

- `quantity` deve ser um n√∫mero inteiro maior que 0;

- Apenas a venda com o `id` presente na URL deve ser atualizada;

- *Observe as regras de neg√≥cio e coloque na camada certa;*

</details>

## Escreva testes para cobrir 40% das camadas da sua aplica√ß√£o

- Seus arquivos de teste devem ficar no diret√≥rio `test/unit`, **como citado [aqui](#para-escrever-seus-pr√≥pios-arquivos-de-teste)**

- Seus testes da `model` devem fazer mock do banco de dados obrigat√≥riamente;

- Opcionalmente voc√™ pode parar o servi√ßo do `MYSQL` em sua m√°quina. Para rodar seus teste utilize `npm run test:mocha`;

</details>

## Crie um endpoint para deletar uma venda

- O endpoint deve ser acess√≠vel atrav√©s do caminho (`/sales/:id`);

- Apenas a venda com o `id` presente na URL deve ser deletado;

</details>

## Atualize a quantidade de produtos

- Ao realizar uma venda, atualiz√°-la ou delet√°-la, voc√™ deve tamb√©m atualizar a quantidade do produto em quest√£o presente na tabela respons√°vel pelos produtos;

  - **Exemplo 1**: suponha que haja um produto chamado *Bola de Futebol* e a sua propriedade `quantity` tenha o valor *10*. Caso seja feita uma venda com *8* unidades desse produto, a quantidade do produto deve ser atualizada para *2* , pois 10 - 8 = 2;
  - **Exemplo 2**: Suponha que esta venda tenha sido deletada, logo estas *8* unidades devem voltar ao `quantity` e seu valor voltar√° a *10*, pois 2 + 8 = 10;

</details>

## Valide a quantidade de produtos

- Um produto nunca deve ter a quantidade em estoque menor que 0;

- Quando uma venda for realizada, garanta que a quantidade sendo vendida est√° dispon√≠vel no estoque

</details>

## Escreva testes para cobrir 50% das camadas da sua aplica√ß√£o

- Seus arquivos de teste devem ficar no diret√≥rio `test/unit`, **como citado [aqui](#para-escrever-seus-pr√≥pios-arquivos-de-teste)**;

- Seus testes da `model` devem fazer mock do banco de dados obrigat√≥riamente;

- Opcionalmente voc√™ pode parar o servi√ßo do `MYSQL` em sua m√°quina. Para rodar seus teste utilize `npm run test:mocha`;

</details>

## Escreva testes para cobrir 60% das camadas da sua aplica√ß√£o

- Seus arquivos de teste devem ficar no diret√≥rio `test/unit`, **como citado [aqui](#para-escrever-seus-pr√≥pios-arquivos-de-teste)**;

- Seus testes da `model` devem fazer mock do banco de dados obrigat√≥riamente;

- Opcionalmente voc√™ pode parar o servi√ßo do `MYSQL` em sua m√°quina. Para rodar seus teste utilize `npm run test:mocha`;

</details>
